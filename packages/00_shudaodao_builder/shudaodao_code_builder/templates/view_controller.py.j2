#!/usr/bin/env python3
# -*- coding:utf-8 -*-
# @License  ：(C)Copyright 2025, 数道智融科技
# @Author   ：Shudaodao Auto Generator
# @Software ：PyCharm
# @Date     ：{{ generated_date }}
# @Desc     ：controller classes for {{ schema_name }}{{ table_or_view_name }}

from shudaodao_core import AsyncSession, AuthRouter, Depends
from shudaodao_core import DataService, QueryRequest, ResponseUtil

from ..entity_view.{{ file_name }} import (
    {{ class_name }}, {{ class_name }}Response
)

{{ class_name }}_Router = AuthRouter(
    prefix="/v1/{{ router_path }}v/{{ file_name }}",
    tags=["{{ schema_name }}view"],
    db_config_name="{{ db_engine_name }}",  # 配置文件中的数据库连接名称
    default_role="{{ auth_role_name }}",  # 系统默认角色具有此权限
    auth_obj="{{ schema_name }}{{ table_or_view_name }}"  # 验证权限用的对象名 动作在具体方法中
)


@{{ class_name }}_Router.post(
    path="/query", auth_act="query", summary=f"检索 {{ schema_name }}{{ table_or_view_name }}")
async def {{ file_name }}_query(
        *, query: QueryRequest, db: AsyncSession = Depends({{ class_name }}_Router.get_async_session)
):
    query_model = await DataService.query(
        db, query, model_class={{ class_name }},
        response_class={{ class_name }}Response
    )
    return ResponseUtil.success(data=query_model, message="查询成功")


@{{ class_name }}_Router.get(
    path="/{primary_id}", auth_act="read", summary=f"获取 {{ schema_name }}{{ table_or_view_name }}")
async def {{ file_name }}_read(
        *, primary_id: int,
        db: AsyncSession = Depends({{ class_name }}_Router.get_async_session)
):
    data_read = await DataService.read(
        db, primary_id, model_class={{ class_name }},
        response_class={{ class_name }}Response
    )
    return ResponseUtil.success(message="获取成功", data=data_read)
